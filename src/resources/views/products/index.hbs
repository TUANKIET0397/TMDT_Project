{{! All product }}
{{#contentFor "styles"}}
    <link rel="stylesheet" href="/css/products.css" />
{{/contentFor}}

  <!-- HERO SLIDER -->
  <section class="hero">
    <h2>Best-seller</h2>
    <p>
      Discover our meticulous curation of the finest pieces from <br /> the
      men's wardrobe around the world.
    </p>

    <form method="GET" id="filterForm" action="/products" class="filter-form">
      <div class="filters">
        <!-- GIÁ -->
        <div class="filter-group">
          <label>Prices</label>
          <select name="price" id="priceFilter" onchange="this.form.submit()">
            <option value="">All Prices</option>
            <option value="low-high" {{#if (eq filters.price 'low-high')}}selected{{/if}}>Low to High</option>
            <option value="high-low" {{#if (eq filters.price 'high-low')}}selected{{/if}}>High to Low</option>
          </select>
        </div>

        <!-- PHÂN LOẠI (CHECKBOX) -->
         <div class="filter-group category-filter-group" style="position:relative;">
      <label class="filter-toggle" id="categoryToggle" tabindex="0">Category <span class="caret">▾</span></label>

      <div class="dropdown-panel" id="categoryPanel" aria-hidden="true">
        <div class="checkbox-group" id="categoryList">
          <label><input type="checkbox" name="category" value="T-Shirts"> T-Shirts</label>
          <label><input type="checkbox" name="category" value="Shirts"> Shirts</label>
          <label><input type="checkbox" name="category" value="Knitwear"> Knitwear</label>
          <label><input type="checkbox" name="category" value="Sweatshirts"> Sweatshirts</label>
          <label><input type="checkbox" name="category" value="Pants"> Pants</label>
          <label><input type="checkbox" name="category" value="Outerwear"> Outerwear</label>
          <label><input type="checkbox" name="category" value="Shoes"> Shoes</label>
        </div>

        <div class="panel-actions">
          <button type="button" id="applyFilters">Apply</button>
          <button type="button" id="clearCategories">Clear</button>
        </div>
      </div>
    </div>


        <!-- SIZE -->
        <div class="filter-group">
          <label>Size</label>
          <select name="size" id="sizeFilter" onchange="this.form.submit()">
            <option value="">All Sizes</option>
            <option value="XS" {{#if (eq filters.size 'XS')}}selected{{/if}}>XS</option>
            <option value="S" {{#if (eq filters.size 'S')}}selected{{/if}}>S</option>
            <option value="M" {{#if (eq filters.size 'M')}}selected{{/if}}>M</option>
            <option value="L" {{#if (eq filters.size 'L')}}selected{{/if}}>L</option>
            <option value="XL" {{#if (eq filters.size 'XL')}}selected{{/if}}>XL</option>
            <option value="XXL" {{#if (eq filters.size 'XXL')}}selected{{/if}}>XXL</option>
          </select>
        </div>

        <p><span id="productCount">{{count}}</span> products</p>
      </div>
    </form>
  </section>

  <section class="best-seller">
    <div class="best-container" id="product-list">
      {{#each products}}
        <div class="best-item" data-category="{{this.TypeName}}" data-price="{{this.Price}}">
          <div class="image-wrapper">      
            <img src="/img/{{this.ImgPath}}" 
                 alt="{{this.ProductName}}"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="alt-text" style="display:none; align-items:center; justify-content:center; width:100%; height:300px; background:#f0f0f0; border:1px solid #ddd; font-size:16px; color:#666;">
              {{this.ProductName}}
            </div>
            <span class="new-label">{{this.Label}}</span>
          </div>   
          <div class="Name-price">
            <h4>{{this.ProductName}}</h4> 
            <div class="price">${{this.Price}}</div> 
          </div>
          <div class="info">
            <p class="desc">{{this.Descriptions}}</p>
            <div class="bottom"></div>
          </div>
        </div>
      {{else}}
        <p style="grid-column: 1/-1; text-align: center; padding: 40px; font-size: 18px; color: #999;">
          No products found
        </p>
      {{/each}}
    </div>
  </section>

<script>
  (function(){
    const toggle = document.getElementById('categoryToggle');
    const panel = document.getElementById('categoryPanel');
    const form = document.getElementById('filterForm'); // now exists
    const applyBtn = document.getElementById('applyFilters');
    const clearBtn = document.getElementById('clearCategories');

    if (!applyBtn || !panel || !toggle || !form) return; // guard

    // open/close panel
    function openPanel() {
      panel.classList.add('show');
      panel.setAttribute('aria-hidden', 'false');
    }
    function closePanel() {
      panel.classList.remove('show');
      panel.setAttribute('aria-hidden', 'true');
    }

    toggle.addEventListener('click', (e) => {
      e.stopPropagation();
      panel.classList.toggle('show');
      panel.setAttribute('aria-hidden', panel.classList.contains('show') ? 'false' : 'true');
    });

    // click outside -> close
    document.addEventListener('click', (e) => {
      if (!panel.contains(e.target) && !toggle.contains(e.target)) {
        closePanel();
      }
    });

    // Apply: submit form (collect checked categories)
    applyBtn.addEventListener('click', () => {
      form.submit();
      // optional: close panel after submit
      closePanel();
    });

    // Clear: uncheck checkboxes but don't auto-submit
    clearBtn.addEventListener('click', () => {
      const boxes = panel.querySelectorAll('input[type="checkbox"]');
      boxes.forEach(cb => cb.checked = false);
    });

    panel.addEventListener('click', (e) => e.stopPropagation());
  })();
</script>

  <script>
    document.getElementById("user-icon").addEventListener("click", function () {
      window.location.href = "/profile";
    });
  </script>